<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QR Certificate Verification</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 720px;
      margin: 40px auto;
      padding: 0 16px;
      background: #fff;
    }
    .logo {
      display: block;
      margin: 0 auto 18px;
      max-width: 220px;
    }
    h1 {
      text-align: center;
      font-weight: 700;
      margin: 0 0 18px;
    }
    .box {
      border: 1px dashed #00a65a;
      padding: 18px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 16px;
    }
    .box.invalid {
      border-color: #e73333;
    }
    .label {
      font-weight: 700;
    }
    .small {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
      word-break: break-word;
    }
  </style>
</head>
<body>

<!-- Optional: put your logo in repo root and reference it like this -->
<img class="logo" src="../logo.png" alt="Logo" onerror="this.style.display='none'">

<h1>QR Certificate <b>Verification</b></h1>

<div id="statusBox" class="box">
  <div id="statusTitle" style="font-weight:700;">Checkingâ€¦</div>
  <div id="details" style="margin-top:12px;"></div>
  <div id="rawId" class="small"></div>
</div>

<div class="box invalid">
  <div class="small" style="color:#333;">
    If the details shown do not match the certificate in front of you, contact the issuer immediately.
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzvvu8IxsT2LkHas6g74GHj7Jl7WjXWUDhaQkwPqkrPl2br4BqsMrkH9Os0yj-4ltx0sw/exec";

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const statusBox = document.getElementById("statusBox");
  const statusTitle = document.getElementById("statusTitle");
  const details = document.getElementById("details");
  const rawId = document.getElementById("rawId");

  if (!id) {
    statusBox.classList.add("invalid");
    statusTitle.textContent = "No Certificate ID Provided";
  } else {
    rawId.textContent = "Certificate ID: " + id;

    fetch(`${API_URL}?id=${encodeURIComponent(id)}`)
      .then(r => r.json())
      .then(data => {
        if (!data.found) {
          statusBox.classList.add("invalid");
          statusTitle.textContent = "Certificate Not Found";
          details.innerHTML = "";
          return;
        }

        const isValid = (String(data.status || "")).toLowerCase() === "valid";

        statusBox.classList.toggle("invalid", !isValid);
        statusTitle.textContent = isValid ? "Certificate Found" : "Certificate Not Valid";

        details.innerHTML = `
          <div><span class="label">Recipient:</span> ${escapeHtml(data.name || "")}</div>
          <div style="margin-top:10px;"><span class="label">Qualification:</span></div>
          <div>${escapeHtml(data.qualification || "")}</div>
          <div style="margin-top:10px;"><span class="label">Award Date:</span> ${escapeHtml(data.awardedDate || "")}</div>
          <div style="margin-top:10px;"><span class="label">Status:</span> ${escapeHtml(data.status || "")}</div>
        `;
      })
      .catch(() => {
        statusBox.classList.add("invalid");
        statusTitle.textContent = "Error Fetching Verification Data";
        details.innerHTML = "<div class='small'>Check Apps Script deployment access and URL.</div>";
      });
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }
</script>

</body>
</html>
