
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin | Issue Certificate</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">

<style>
html,body{background:#fff;font-family:Roboto,Arial,sans-serif}
.login-logo{text-align:center;font-size:30px;font-weight:300;margin:40px 0 20px}
.panel{border:1px dashed #bbb}
.btn-black{background:#000;color:#fff;border:0}
.btn-black:hover{background:#111}
#qrcode{display:flex;justify-content:center;margin-top:15px}
.small{font-size:12px;color:#666;word-break:break-all;text-align:center;margin-top:10px}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div class="container">
<div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">

<div class="login-logo">Admin <b>Issuer</b></div>

<div class="panel panel-default panel-body">

<div class="form-group">
<label>Certificate ID (required)</label>
<input class="form-control" id="certId" placeholder="GA-2026-000123">
</div>

<div class="form-group">
<label>Recipient</label>
<input class="form-control" id="name">
</div>

<div class="form-group">
<label>Qualification</label>
<input class="form-control" id="qualification">
</div>

<div class="form-group">
<label>Award Date</label>
<input class="form-control" id="awardedDate" type="date">
</div>

<button class="btn btn-black btn-block" id="issueBtn" onclick="issue()">Issue + Generate QR</button>

<hr>

<div id="status" style="text-align:center;font-weight:700"></div>
<div id="qrcode"></div>
<div class="small" id="verifyLink"></div>

</div>
</div>
</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbyXdlN9IkvKP9ND1P8CF7YhsbAZxOnxXmVuXJH_4FQBDIQ56opButLXm8FaiU7BscX1-g/exec";
const VERIFY_BASE = "https://lovelaughlive666hqhq.github.io/GATEAWAYHOUSE/verify";

async function issue(){

const certId = document.getElementById("certId").value.trim();
const name   = document.getElementById("name").value.trim();
const qual   = document.getElementById("qualification").value.trim();
const date   = document.getElementById("awardedDate").value;

if(!certId || !name || !qual || !date){
alert("All fields are required.");
return;
}

document.getElementById("issueBtn").disabled = true;
document.getElementById("status").textContent = "Issuing...";
document.getElementById("qrcode").innerHTML = "";
document.getElementById("verifyLink").textContent = "";

try{

const res = await fetch(API_URL,{
method:"POST",
headers:{
"Content-Type":"text/plain;charset=utf-8"   // IMPORTANT for Apps Script
},
body: JSON.stringify({
certificate_id: certId,
recipient: name,
qualification: qual,
award_date: date
})
});

const data = await res.json();

if(data.status !== "ok"){
document.getElementById("status").textContent = data.message || "Failed";
document.getElementById("issueBtn").disabled = false;
return;
}

const verifyURL = VERIFY_BASE + "?id=" + encodeURIComponent(certId);

document.getElementById("status").textContent = "Issued: " + certId;

new QRCode(document.getElementById("qrcode"),{
text: verifyURL,
width:220,
height:220
});

document.getElementById("verifyLink").textContent = verifyURL;

}catch(e){
document.getElementById("status").textContent = "Network or server error";
}

document.getElementById("issueBtn").disabled = false;
}

</script>

</body>
</html>
